<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista Bivacchi con Hello Kitty</title>
    <style>
        /* Stile del cursore personalizzato */
        html {
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="%23FF69B4" d="M16 2C8.2 2 2 8.2 2 16s6.2 14 14 14 14-6.2 14-14S23.8 2 16 2zm0 2c6.6 0 12 5.4 12 12s-5.4 12-12 12S4 22.6 4 16 9.4 4 16 4z"/><circle fill="%23FF69B4" cx="11" cy="11" r="2"/><circle fill="%23FF69B4" cx="21" cy="11" r="2"/><path fill="%23FF69B4" d="M16 20c-2.8 0-5-2.2-5-5h2c0 1.7 1.3 3 3 3s3-1.3 3-3h2c0 2.8-2.2 5-5 5z"/><path fill="%23FF69B4" d="M16 24c-1.1 0-2-.9-2-2h4c0 1.1-.9 2-2 2z"/></svg>') 16 16, auto;
        }
        
        /* Elementi cliccabili devono mantenere il puntatore standard */
        button, input, select, textarea, .delete-btn {
            cursor: default;
        }

        /* Stili esistenti */
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            background-color: #45a049;
        }
        .edit-form {
            display: none;
            margin: 20px 0;
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
        }
        .edit-form input, .edit-form select {
            margin: 5px 0;
            padding: 8px;
            width: 100%;
        }
        .annotations-box {
            margin: 20px 0;
            padding: 15px;
            background-color: #f0f7ff;
            border: 1px solid #b3d1ff;
            border-radius: 5px;
        }
        .annotations-box h3 {
            margin-top: 0;
            color: #0066cc;
        }
        #annotationsText {
            width: 100%;
            min-height: 80px;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            font-family: Arial, sans-serif;
        }
        #saveAnnotations {
            background-color: #0066cc;
        }
        #saveAnnotations:hover {
            background-color: #0052a3;
        }
        .delete-btn {
            width: 24px;
            height: 24px;
            cursor: pointer;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ff0000"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>') no-repeat;
            border: none;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>Lista Bivacchi</h1>
    
    <!-- Box annotazioni -->
    <div class="annotations-box">
        <h3>Annotazioni</h3>
        <textarea id="annotationsText" placeholder="Scrivi qui note generali..."></textarea>
        <button id="saveAnnotations">Salva Annotazioni</button>
    </div>
    
    <!-- Pulsante aggiungi bivacco -->
    <button id="editButton">Aggiungi Bivacco</button>
    
    <!-- Form per nuovo bivacco -->
    <div id="editForm" class="edit-form">
        <h3>Nuovo Bivacco</h3>
        <input type="text" id="nome" placeholder="Nome" required>
        <input type="text" id="provincia" placeholder="Provincia">
        <input type="number" id="altitudine" placeholder="Altitudine (mt)">
        <input type="number" id="postiLetto" placeholder="Posti letto">
        <select id="camino">
            <option value="">Camino...</option>
            <option value="Si">Si</option>
            <option value="No">No</option>
        </select>
        <select id="stufa">
            <option value="">Stufa...</option>
            <option value="Si">Si</option>
            <option value="No">No</option>
        </select>
        <input type="number" id="qualita" placeholder="Qualità (1-10)" min="1" max="10">
        <button id="saveButton">Salva</button>
    </div>
    
    <!-- Tabella bivacchi -->
    <table id="bivacchiTable">
        <thead>
            <tr>
                <th>#</th>
                <th>Nome</th>
                <th>Provincia</th>
                <th>Altitudine</th>
                <th>Posti letto</th>
                <th>Camino</th>
                <th>Stufa</th>
                <th>Qualità</th>
                <th>Elimina</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <tr>
                <td colspan="9" class="loading">Caricamento dati in corso...</td>
            </tr>
        </tbody>
    </table>

    <script>
        // Elementi DOM
        const editButton = document.getElementById('editButton');
        const editForm = document.getElementById('editForm');
        const saveButton = document.getElementById('saveButton');
        const tableBody = document.getElementById('tableBody');
        const annotationsText = document.getElementById('annotationsText');
        const saveAnnotationsBtn = document.getElementById('saveAnnotations');

        // File di testo per i dati
        const DATA_FILE = 'testo.txt';
        const ANNOTATIONS_FILE = 'annotazioni.txt';

        // Mostra/nascondi form
        editButton.addEventListener('click', () => {
            editForm.style.display = editForm.style.display === 'block' ? 'none' : 'block';
        });

        // Salva nuovo bivacco
        saveButton.addEventListener('click', async () => {
            const nuovoBivacco = {
                nome: document.getElementById('nome').value || "Senza nome",
                provincia: document.getElementById('provincia').value || "-",
                altitudine: document.getElementById('altitudine').value || "-",
                postiLetto: document.getElementById('postiLetto').value || "-",
                camino: document.getElementById('camino').value || "-",
                stufa: document.getElementById('stufa').value || "-",
                qualita: document.getElementById('qualita').value || "-"
            };

            try {
                // Leggi i dati esistenti
                const response = await fetch(DATA_FILE);
                let data = await response.text();
                let bivacchi = data ? JSON.parse(data) : [];
                
                // Aggiungi il nuovo bivacco
                bivacchi.push(nuovoBivacco);
                
                // Salva i dati
                await saveDataToFile(DATA_FILE, JSON.stringify(bivacchi));
                
                // Ricarica la tabella
                await loadData();
                editForm.style.display = 'none';
                resetForm();
            } catch (error) {
                console.error("Errore durante il salvataggio:", error);
                alert("Si è verificato un errore durante il salvataggio.");
            }
        });

        // Salva annotazioni
        saveAnnotationsBtn.addEventListener('click', async () => {
            try {
                await saveDataToFile(ANNOTATIONS_FILE, annotationsText.value);
                alert("Annotazioni salvate!");
            } catch (error) {
                console.error("Errore durante il salvataggio delle annotazioni:", error);
                alert("Si è verificato un errore durante il salvataggio delle annotazioni.");
            }
        });

        // Carica i dati iniziali
        async function loadData() {
            try {
                // Carica bivacchi
                const response = await fetch(DATA_FILE);
                const data = await response.text();
                const bivacchi = data ? JSON.parse(data) : [];
                
                // Carica annotazioni
                const annotationsResponse = await fetch(ANNOTATIONS_FILE);
                const annotationsData = await annotationsResponse.text();
                annotationsText.value = annotationsData || '';
                
                // Renderizza la tabella
                renderTable(bivacchi);
            } catch (error) {
                console.error("Errore durante il caricamento dei dati:", error);
                tableBody.innerHTML = '<tr><td colspan="9">Errore durante il caricamento dei dati. Ricarica la pagina.</td></tr>';
            }
        }

        // Renderizza la tabella
        function renderTable(bivacchi) {
            tableBody.innerHTML = '';
            
            if (bivacchi.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="9">Nessun bivacco presente. Aggiungine uno!</td></tr>';
                return;
            }
            
            bivacchi.forEach((bivacco, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${bivacco.nome}</td>
                    <td>${bivacco.provincia}</td>
                    <td>${bivacco.altitudine}</td>
                    <td>${bivacco.postiLetto}</td>
                    <td>${bivacco.camino}</td>
                    <td>${bivacco.stufa}</td>
                    <td>${bivacco.qualita}</td>
                    <td><button class="delete-btn" data-index="${index}"></button></td>
                `;
                tableBody.appendChild(row);
            });

            // Aggiungi event listener ai pulsanti di eliminazione
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const index = e.target.getAttribute('data-index');
                    try {
                        // Leggi i dati esistenti
                        const response = await fetch(DATA_FILE);
                        let data = await response.text();
                        let bivacchi = data ? JSON.parse(data) : [];
                        
                        // Rimuovi il bivacco
                        bivacchi.splice(index, 1);
                        
                        // Salva i dati
                        await saveDataToFile(DATA_FILE, JSON.stringify(bivacchi));
                        
                        // Ricarica la tabella
                        await loadData();
                    } catch (error) {
                        console.error("Errore durante l'eliminazione:", error);
                        alert("Si è verificato un errore durante l'eliminazione.");
                    }
                });
            });
        }

        // Funzione per salvare dati su file (simulata)
        async function saveDataToFile(filename, data) {
            // Nota: Questo è un approccio semplificato che funziona solo con alcuni server
            // In un ambiente reale, avresti bisogno di un backend per scrivere su file
            try {
                const response = await fetch(filename, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ content: data })
                });
                
                if (!response.ok) {
                    throw new Error('Errore durante il salvataggio');
                }
                
                return true;
            } catch (error) {
                console.error("Errore nel salvataggio su file:", error);
                throw error;
            }
        }

        // Funzioni di supporto
        function resetForm() {
            document.getElementById('nome').value = '';
            document.getElementById('provincia').value = '';
            document.getElementById('altitudine').value = '';
            document.getElementById('postiLetto').value = '';
            document.getElementById('camino').value = '';
            document.getElementById('stufa').value = '';
            document.getElementById('qualita').value = '';
        }

        // Inizializza la pagina
        loadData();
    </script>
</body>
</html>
